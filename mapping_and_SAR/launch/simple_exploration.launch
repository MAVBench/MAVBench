<launch>
  <arg name="mav_name" default="airsim_qc" />
  <arg name="enable_logging" default="true" />
  <arg name="enable_ground_truth" default="true" />
  <arg name="log_file" default="$(arg mav_name)" />

  
  <node pkg="tf" type="static_transform_publisher" name="tf_53" args="0 0 0 0 0 0 world fcu 100" />

  

  <!-- args --> 
    <!-- Behzad's workstation ip --> 
    <!-- arg name="host_ip" value="10.157.34.101" /--> 
    <arg name="host_ip" value="10.157.90.51" /> 
    <!-- Hasans's workstation ip --> 
    <!-- arg name="host_ip" value="10.157.34.208" /--> 
    
    <!-- setting DEBUG to false prevents publishing and subscribing to rviz /--> 
    <!-- also planning to prevent stdio stuff(if they really matter)--> 
    <arg name="DEBUG" value="true" /> 
    <param name="ros_DEBUG" type="bool" value="$(arg DEBUG)" />

    <!-- set this to "" if you don't want perf -->
    <arg name="my_launch_prefix" value="" /> 
    <!-- arg name="my_launch_prefix" value="/home/nvidia/install/perf/perf record -g fp"/ -->
    


    <!-- starting nodes --> 
	<!-- Point-cloud publisher -->
 	<node pkg="airsim_img_publisher" type="airsim_imgPublisher" name="airsim_imgPublisher">
		<!-- IP of the Airsim computer -->
		<param name="Airsim_ip" value="$(arg host_ip)" />


		<!-- Port of the Airsim computer (this is default, do not change!) -->
		<param name="Airsim_port" value="41451"/>

		<!-- RGB camera parameters (parameters when calibrated) -->
		<param name="Fx" value="128"/>
		<param name="Fy" value="128"/>
		<param name="cx" value="128"/>
		<param name="cy" value="72"/>
		<param name="width" value="256"/>  <!-- Width when calibrated!-->
		<param name="height" value="144"/> <!-- Height when calibrated!-->

		<!-- Depth baseline -->
		<param name="Tx" value="0.14"/> 
		<param name="scale" value="0.38"/> 
		<param name="maxDist" value="50.0"/> 

		<!-- Topic with odometry information for the vehicle (used to create tf tree) -->
	    <!-- we are not using the odomTopic since arisim is not providing it at themoment -->	
        <param name="odomTopic" value="/mavros/local_position/odom"/>
	</node>

    <!-- publishing pose values --> 
    <node pkg="interface_airsim" type="publish_pose" name="publish_pose" output="screen">
        <param name="ip_addr" value="$(arg host_ip)"/>
    </node>

	<!-- Nodelet manager for this pipeline -->
	<node pkg="nodelet" type="nodelet" args="manager" name="depth_transforms_manager"/>

	<!-- Convert to point cloud -->
	<node pkg="nodelet" type="nodelet" name="cloudify"
	args="load depth_image_proc/point_cloud_xyz depth_transforms_manager --no-bond">

		<!-- Input: Camera calibration and metadata.  (sensor_msgs/CameraInfo) -->
		<remap from="rgb/camera_info" to="/Airsim/camera_info"/> 
		<!-- Input: Rectified depth image -->
		<remap from="image_rect" to="/Airsim/depth"/>

    </node>
	<node pkg="nodelet" type="nodelet" name="cloudify2"
	args="load depth_image_proc/point_cloud_xyz depth_transforms_manager --no-bond">

		<!-- Input: Camera calibration and metadata.  (sensor_msgs/CameraInfo) -->
		<remap from="rgb/camera_info" to="/Airsim/camera_info"/> 
		<!-- Input: Rectified depth image -->
		<remap from="image_rect" to="/Airsim/depth"/>
		<remap from="points" to="points2"/>

    </node>



	<!-- rviz -->
	<group if="$(arg DEBUG)">
	<node pkg="rviz" type="rviz" name="rviz" args="-d $(find package_delivery)/extras/rvizConfig.rviz"/>
	</group> 

  
  
  
  <include file="$(find interface_airsim)/launch/mav_inspector.launch">
    <arg name="mav_name" value="$(arg mav_name)" />
    <arg name="waypoint_x" value="0.0" />
    <arg name="waypoint_y" value="0.0" />
    <arg name="waypoint_z" value="1.0" />
    <arg name="param_file" value="$(find interface_airsim)/resource/exploration.yaml" />
    <arg name="enable_logging" value="$(arg enable_logging)" />
    <arg name="enable_ground_truth" value="$(arg enable_ground_truth)" />
    <arg name="log_file" value="$(arg log_file)" />
    <arg name="tf_frame" value="fcu" />
    <arg name="pcl_topic" value="/points" />
    <arg name="resolution" value="0.4" />
    <arg name="visualize_max_z" value="7" />
    <arg name="sensor_max_range" value="4.0" />
  </include>
</launch>
